* Code (general Julia)
** TODO check Symbols for sorting functional groups
** TODO Check arguments order in functions
   SCHEDULED: <2018-03-18 So> DEADLINE: <2018-03-28 Mi>
** TODO Read "Eval of julia code"
   SCHEDULED: <2018-03-18 So> DEADLINE: <2018-03-28 Mi>
** Fields in Arrays [1/1]
   - [ ] use eachindex() for going throughh the landscape
   - [X] element-wise change is not possible for arrays nor dict of mutable structs: ONLY POSSIBLE IF STRUCTS ARE BUILT INDIVIDUALLY: NO FILL!!
** TODO check necessity new() in structs 
   DEADLINE: <2018-03-28 Mi>
* main.jl
** TODO test *simulate()* for reading and creating initial conditions :inputs:
   DEADLINE: <2018-03-30 Fr> SCHEDULED: <2018-03-18 So>
- [ ] better format for [[Inputs][initorgs]]: Dictionnary or different structure
- [ ] verify if it can take initilization info on [[Organisms.jl][multiple functional groups]]
** Unity tests
*** REPL prints
*** Simulog
* Inputs
** Fileprep.jl
** DONE *lengthstocell()* and *areatocell* convert/calculates real fragment sizes to grid cell side lengths CLOSED: <2018-03-02 Fr>
** Temperature & precipitation: German weather station (South station in Göttingen is quite representative) and Kathrin, from EU climate project, with more micro scale measurements, on a subset of the fragments
- [ ] Species temperature and optimum temperature and precipitation values 
*** DONE OrgsRef: [3/4]
    CLOSED: [2018-04-26 Do 12:09]
      *OrgsRef structure:* each parameter is a field, species are the keys to access the parameter values.
- [ ] come up with structure (dict or composite type) to store the parameters of different species/fgroups, instead of tables?
<2018-03-18 So>: Eventhough they are more rigid, structs are easier to call and the fields have more flexibility to store different kinds of information on the functional group parameters 
DEADLINE: <2018-03-23 Fr>
- [X] read in input: from file into whatever structure I choose to store the parameter values
Read .csv file with JuliaDB because it is easier to call the parameters by name (DataFrames and readcsv might have something similar, but synthax is easier right now).
_Originally_
    1. Species list per funcitonal group (*species_classif.csv*): classifcation of the species list according to functional. Useful to create orgs. That's all. All further parametrization will come from the fgroups pars file
    2. Parameters of functional groups (*fgroups_pars*): biomass (mean & sd), seed mass(mean & sd), lifespan and everything else that comes from the clustering analysis and necessary in Organisms.jl
    3. Initial list and  abundances of species (*initial_sps.csv*)
_Actual implementation_
*spinput.csv* has the list of species parameters and initial conditions 
* Outputs
** REPL messages
** Detailed (print based unity testing)
** Simulation results/outputs
*** id simulation
- [X] 'simID' variable holds the ID of the simulation
- [X] simID.txt has input file names, simulation duration (all parsed arguments)
- [X] parse arguments to script: ArgParse "Module for command-line argument parsing"
- [ ] Identify folder with slurm jobs (not necessary if HPC keep working)
- [ ] output landscape configuration every time step
*** individuals results
- [ ] Check orgstable format: weekly simple csv. Leave more complicated formats to analysis
- [ ] Output analysis R script
- [ ] output landscape information
- [ ] interaction matrix (*pollination!()*)
** Errors (proper unity tests)

* Parametrization
  DEADLINE: <2018-03-28 Mi> SCHEDULED: <2018-03-14 Mi>
- [ ] Trait values:  LEDA database, Annetta Leinjärtner, Bernhard Hoiß
Type of data: Annual/perennial, dispersal mode, dispersal parameters, seed mass, seed number, 
  - [ ] herbs: LEDA/TRY, LEDA probably more uniform, Lina Wieß
  - [ ] butterflies: Jochen
  - [ ] bees:
- [X] Clustering analysis for functional groups: not yet. Force sp-specific values. Consider it for NAs.
- [ ] Interactions data: Ingo Grass paper
* Setworld.jl
*** DONE Create multi fragment landscape structure (not simulated yet) 
**** TODO create multifragment structure with fragments of different sizes, because so far, they are all the same size
     SCHEDULED: <2018-05-01 Di>
*** DONE Whole fragment is getting the same temperature and preciptation
    Because assignment of one field changes all the fields of the array!
    However, it is not necessary to have microhabitats and there is no data to such level of detail, therefore, no need for cell specific environmental conditions
*** DONE Change names so that temperature and preciptation can be called niche dimensions: no need
*** TODO Initialize
    DEADLINE: <2018-03-30 Fr>
*readinlandscp* Initial landscape conditions are read from *landscpinit* file and stored in Dict: so far, *read_initials()* is doing it
*landscape_init()* create landscape with WHICH DIMENSIONS?
- Reshaping in landscape should use max fragment dimensions? For square fragments, easy, but if shape varies, it is problematic.
- Find another type of structure to hold the landscape structure OR use a 1D array, and elaborate an indexation to identify x,y and frag? 
  -> Inside the fragments loop, reshape each fragment and append it to some 3D structure?
*** Change during simulation
DEADLINE: <2018-03-28 Mi>

*** TODO create landscapes with n_frags > 1

* Organisms.jl
Initialization spreads organisms in the landscape (fragments, later): newOrg() is called
During simulation, after reproduction (and dispersion?) new organisms will only establish once it has checked local grid viability and fitness values?
   DEADLINE: <2018-04-02 Mo>
** DONE check probability models for transitions
   CLOSED: [2018-04-03 Di 10:25]
   - CLOSING NOTE [2018-04-03 Di 10:25] \\
     p = 1 - exp(-rt)
** TODO mutable struct [1/6]
   DEADLINE: <2018-04-30 Mo> SCHEDULED: <2018-03-14 Mi>
- [ ] .sex field, for controlling sex-ratio, for insects
- [ ] Genotype must control some traits
- [ ] Traits should match for interaction to happen. Microevolutionary change would cause traits to (mis)match
- [X] Biomass is a dictionary with compartments that get the allocations (vegetative and reproductive masses)
- [ ] Genotype defines species?
- [ ] Interaction field: Plants have a list of visitors and pollinators have a list of IDs of pollen. Pollen decay should eliminate pollen after certain time step.
  - [ ] verify pollen decay
** DONE use length(orgs) for IDcounter 
   CLOSED: [2018-03-25 So 20:00] DEADLINE: <2018-03-23 Fr> SCHEDULED: <2018-03-08 Do>
   - CLOSING NOTE [2018-03-25 So 20:00] \\
     Uglier, but more straight forward
** DONE Simulate single plant species/functional group [4/4] :initialization:
Organisms are stored in an array of n_frags (read from simulation file). All organisms are stored in this array and are updated together (each fragment - it could be possible to have simulations where there is some desynchronization between fragments!).
*newOrg()* will have multiple methods: One for initialization, where individuals always establish and another where it depends on the individuals fitness in the grid and establishment!() is called.  
 - [X] Initialize a certain number of organisms
   - [X] get fct types and abundances from input file
   - [X] create orgs somewhere ('organisms' Array)
   - [X] properly index individuals in the WordCell landscape
     - [X] create bunch of locations and draw from them CLOSED <2018-02-21 Mi>
     - [X] all cells get the same quantity (init_abund) of organisms, the locations are rdm, though. The loop inside XYs is causing it. --> because the *landscape.orgs* field was initialized with empty orgs, *push!()* would add the same orgs to  all the cells! Individuals are now stored in *orgs* array, instead. Even ig that is not the real problem, it makes indexation easier CLOSED <2018-02-22 Do>
     - [X] create different arrays for different fct groups: For now, not necessary, as functional group should be available as field of orgs array. CLOSED <2018-02-23 Fr> 
 - [X] correct IDcounter: global in Organisms module, exported and called in newOrgs!()
 - [X] check ERROR with method on function newOrgs(): why push! nao funciona? Because all arry's contents had been initialized at the same time <2018-02-26 Mo>.
 - [X] Simulate single functional group
   - [X] reproduction: pollinator independent = use reproduction probability
   - [X] wind and ant pollination (see *reproduction()*): Bullock et al. 2017: 
** DONE Create organisms of different functional groups
   CLOSED: [2018-04-27 Fr 09:35]
During initialization, one input file gives the functional types and their initial abundances, vegmass, reprodmass
- [X] input file format: csv file, created wiht R (*traits project*)
*** orgs: Store individuals
- [X] How to store multiple types of organisms: single array. Might be necessary to change it, if calling specific fct types reveals itself to be important and can't be done otherwise
** Life-cycle
*** TODO Check MTE units & probabilities!!!
**** Boltz: Chap.2 MTE book <2018-04-02 Mo>
**** aE: Chap.2 MTE book <2018-04-02 Mo>
**** plant production growth: Ernet et al. 2003 <2018-04-02 Mo>
*** TODO Compete [4/5]
 Competition is biomass-based: overlap of area gives rise to /compterm/ that penalizes growth
 - [X] Vegetative biomass is projected to calculate competition /compterm/: *projectvegmass!()*
Projection outside boundaries are not being taken into account: *edge effects* come up, because "realized biomass" i smaller
 - [ ] The landscape cell has biomass carrying capacity of each /.fgroup/ it can sustain. If that max is attained, the organism in question DOES WHAT? HOW IT CAN BE PENALIZED?
 - [X] Initialize a 'competition landscape' for the plants: /.neighs/ field in the landscape holds a dictionnary with sum of biomass projected by each individual of a functional group
 - [X] Competition arises form growth rate being penalized by overlapping 
 - [X] When competition is too strong (/compterm/ <= 1) individual has an increased probability of dying 
*** DONE Growth
    Inside allocation, calculated according to MTE 
*** TODO Allocation [2/3]
    DEADLINE: <2018-03-28 Mi>
- [-] Divide biomass GAIN according to allocation to survival, growth and reproduction. The allocation will depend on the stage:
  - [X] sorts things into the individual's /biomass/ Dictionnary
  For _eggs/seed (e)_:
  - [ ] Only consume reserve = decrease biomass
      SCHEDULED: <2018-03-18 So>
  For _juveniles (j)_:
  - [X] Biomass goes into /veg/ dictionnary entry: this is used in *projvegmass!()* for plants
  For _adults (a)_:
  - [ ] Biomass goes into /reprd/ dictionnary entry: this is used in *projrepmass!()* for plants
  - [ ] TODO Only exists during reproductive season, controlled by *age* and *fgroup* (gives the duration of reproductive season): for annuals, it should arise from stage transitions, but how about perennials?
      SCHEDULED: <2018-03-18 So>
- [X] Biomass gain depends on competition: normalize *compterm* 
- [X] *allocation()* disentangled from *survive!()*, which is based on whole body mass. The MTE is based on dry weights, which means that underlying energetic budget doesn't need to be taking into account if the most important functions in the model (growth and reprodction), can be modelled via the biomass allocated to those structures. Other life-history traits, such as survival, will depend on the resulting total biomass. *Resistance structures are NOT being taken into account*, any accumulatiion of biomass should reflect in the mass-dependent survival function. 
**** TODO Complex allocation
- [ ] The allocation rules should give rise to the appropriate growth curve (von Bertalanfy for insects, for example)
Parameters values might be specific to each functional group, but general mechanism must be the same fo plants and insects, at least.
 *REFERENCES*:
 -Irlich et al. 2009: Why MTE doenst fit for insect
 1. Wenk & Falster 2015: Reproductive allocation schedules in plants -> Find something similar for insects
 2. Janczur: Good model of allocation (general)
 3. Weiß & Jeltsch 2015: ZOI
 4. Weiner et al. 2001: Plant growth
 5. Lin et al. J of Ecol. 2012: MTE for plants and interaction
 6. Nestel et al. J Insect Physiol. 2016: Resource allocation in insects
 7. Boggs Func. Ecol. 2009: Review 
 8. For insects, nutrient allocation is a function of AGE & SEX (Boggs Func. Ecol. 2009)
*** TODO Adjust initial abundance to realistic observed densities
*** TODO Emergency [0/2]
    DEADLINE: <2018-03-29 Do>
- [-] emergency rate differentiates between functional groups
  - [X] plants germinate: hard coded, 0.5 probability
  - [ ] according to the list of fgroups from the input
- [ ] Seed bank
*** TODO Reproduction [3/5]
    DEADLINE: <2018-03-23 Fr>
- [X] pollination independent [[ch][check Dispersal description]]
- [ ] pollination-independent: reproduction depends on finding partners inside [[Pollination][pollen dispersal kernel]]
- [X] fertility is calculated according to MTE, which depends on TOTAL biomass: The allocation of biomass to reproduction and growth allows controlling competition, and the rates are affected indirectly, if competition decreases due to total biomass reduction due to competition or herbivory.
- [ ] use newOrgs 2nd method for creating the orgs and handling genetics of fertilization
****  Decide on newOrgs!() is called between reproduction and establishment: Are new individuals created right after reproduction?
<<<<<<< HEAD
*** TODO Dispersal [0/4]
=======
*** Dispersal [4/5]
>>>>>>> 40ba2e79953a377b67fe6ccce230bfc8a50e79cb
    SCHEDULED: <2018-03-18 So>
*Perfect wind and ant dispersal kernels: ExP and Log-Sech* BUT their distributions are not in Julia. Having the pdf, it is necessary to find the inverse of it. For some pdfs, it might not exist (if they are bijective functions), and the Monte Carlo method would be necessary.
Possibilities:
1. *Currently implemented:* Use the InverseGaussian, because it seems to have similar values and the ExP is also known as "generalized Gaussian"
- [X] Random distances from 50-95th percentiles: close enough for the InverseGaussian (see notebook)
- [X] Connectivity matrix: 
  - [X] Eucledian distances:  Eucledian distances should fall inside the distance taken from dispersal kernel
- [ ] Sort out Saura & Pascual-Hortal's probability of connectivity(landscape property) and dispersal kernel (organism property): there might not be a way of combining, since they are properties of different entities.
  - [ ] Could it inform dispersal success?
  - [ ] Check [[https://www.researchgate.net/post/Which_connectivity_index_should_I_use_to_compare_different_networks_of_protected_areas][connectivity_discussion]] Probability of connectivity
2. Try monte Carlo variable generation in R and randomly draw from them.
*** TODO Update organisms: [0/2]
  - [ ] Simultaneous or independent update?
  - [ ] Consider making a mutable struct where each field stores the individuals of a functional group, therefore, when updating the organisms, I wouldn't have to go through all of them, just through the group affected by the function in question 
*** DONE Density-independent mortality: *survive!()* [2/2]
    DEADLINE: <2018-04-02 Mo>
Not totally independent because depends on biomass, which affects individuals biomass and the mortality rate/probability consequently
- [X] Probability of dying from MTE rate
  - [ ] Conversion: pdf() Returns the probability density of distribution d evaluated at x.
- [X] Deleting from structure with deleteat!() avoids mixing up indices in orgs array
- [ ] Check scheduling of deaths: do seeds die when not germinated or are they stored and killed later?
*** TODO Density-dependent mortality: *survive!()* [1/2]
- [X] *compete()* adds a probability of dying
- [ ] differentiate b_0 from density-independent/MTE rate
*** TODO Inter-specific interactions [0/2]
- [ ] Input of interaction matrix to control pollination and 
- [ ] Interaction matrix of frequency
**** TODO Interactions modelled "by" the *outcomes* (Tikhonov et al. 2017, Spiesman & Inouye 2014) 8[0/1]
  - [ ] Is it possible to integrate interaction outcomes and MTE? The patterns would lead to enregy flux across community levels
*** DONE Germination [1/2]
    CLOSED: [2018-03-25 So 19:36] SCHEDULED: <2018-03-25 So>
    - CLOSING NOTE [2018-03-25 So 19:36] \\
      v0.1 has a prototype of seed bank. Make a more realistic one next
- [X] germination rate turned into probability
- [ ] one-year seed bank for seeds: actually, should arise from seed mortality
*** Pollination
**** DONE Wind pollination [2/2]
     CLOSED: [2018-03-21 Mi 10:22] DEADLINE: <2018-03-20 Di> SCHEDULED: <2018-03-20 Di>
     - CLOSING NOTE [2018-05-21 Mo 10:22] \\
- [ ] Check Nathan et al. (dispersal book table) for poolen kernels
- [ ] Finding partners inside it: draws a distance from exponential power mean and checks for partner there
**** Animal pollination [0/4]
- [ ] PollCell is a "pollination landscape cell" that stores 
- [ ]  Attraction of reproductive areas: Visitation frequency as a measure of attraction and/or patch flower density as a quadratic function with an optimum (if too high, there are dillution effects)
- [ ] "Register" visit on interaction matrix and on both plant and insect
- [ ]  ENERGY TRANFERS
- [ ] Julia DB NSparse for interaction matrices
** Evolutionary dynamics
Juliano's suggestion: Create a function of trait distribution change depending on abundance or temperature, so that the time 
* Observation model
*Different from Virtual Ecologist approach* : OM always exists, VE verifies parametrization algorithm and data sampling method
** Hierarchical model for estimating true abundances from count data?
 - How VE verification of sampling method and this hierarchical model?
* Output analysis
** Rank-bundance
** SAR
** Time series:
*** Richness
*** mean biomass
Use JuliaDB/dplyr to groupby and plot from  
* DOCUMENTATION
*** TODO Update TRACE
Describe wind pollen dispersal, seed dispersal, reproduction and germination submodels
    DEADLINE: <2018-03-23 Fr>
*** TODO Define/Justify Organism characterization: how broad is it going to be?[0/1]
Main attribute: It must be able to represent plants and insects
- [ ] PowerPoint & TRACE!
   DEADLINE: <2018-03-30 Fr> SCHEDULED: <2018-03-14 Mi>
